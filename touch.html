<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0" />
    <title>jQueryTouch test page</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="js/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="jquery.touch.js"></script>
</head>
<body>
	
    <div class="body-area" id="test-area">
        <div class="leftPanel"></div>
        <div class="rightPanel"></div>
    </div>
    <div id="last-event">
        <p id="last-event-name">
        </p>
        <pre id="last-event-detail"></pre>
    </div>
    <div id="original-event">
    </div>
    <div style="width:20px;height:20px;background-color:#00ff00;top:0px;left:0px;position:fixed;margin-left:-10px;margin-top:-10px;border-radius:50%;" id="centerIndicator"></div>

    <script>
    	var minLimit = 200;
    	var tangible = false;

    	var centerX;
    	var centerY;
/*
        var firstTouchDistance;
        var secondTouchDistance;
        var thirdTouchDistance;
*/


        function syntaxHighlight(json) {
            if (typeof json != 'string') {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'key';
                    } else {
                        cls = 'string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'boolean';
                } else if (/null/.test(match)) {
                    cls = 'null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        $("#test-area").touchInit();

        var timeout_id = null;
        var last_original_event = null;
        var handler = function (e) {
            $("#last-event-name").text(e.type);
            var showData =
                    {
                        clientX: e.clientX,
                        clientY: e.clientY,
                        pageX: e.pageX,
                        pageY: e.pageY,
                        screenX: e.screenX,
                        screenY: e.screenY,
                        touches: e.touches
                    };

            var x = [];
            var y = [];

            var xDist = [];
            var yDist = [];

            $("#last-event-detail").html(syntaxHighlight(JSON.stringify(showData, undefined, 2)));

            for (var i = showData.touches.length - 1; i >= 0; i--) {
                x[i] = showData.touches[i].screenX;
                y[i] = showData.touches[i].screenY;
            };

            if (showData.touches.length > 3) {

                for (var i = 0; i < showData.touches.length; i++) {
                    /*for (var j = 0; j < showData.touches.length; j++) {
                        xDist[i] = Math.sqrt(Math.pow(x[0]-x[j],2));
                        yDist[i] = Math.sqrt(Math.pow(y[0]-y[j],2));
                    }; */ 
                    xDist[i] = Math.sqrt(Math.pow(x[0]-x[i],2));
                    yDist[i] = Math.sqrt(Math.pow(y[0]-y[i],2));
                };

                console.log("x distances: " + xDist);
                //console.log("y distances: " + yDist);

                /*firstTouchDistance = Math.sqrt(Math.pow(x[0]-x[1],2));
                secondTouchDistance = Math.sqrt(Math.pow(x[0]-x[2],2));
                thirdTouchDistance = Math.sqrt(Math.pow(x[0]-x[3],2));

                console.log(firstTouchDistance);
                console.log(secondTouchDistance);
                console.log(thirdTouchDistance);*/

                if (xDist[1]<minLimit && xDist[2]<minLimit && xDist[3]<minLimit && yDist[1]<minLimit && yDist[2]<minLimit && yDist[3]<minLimit) {
                    $(".body-area").addClass("highlightArea");
                    tangible=true;
                } else {
                    $(".body-area").removeClass("highlightArea");
                    tangible=false;
                }



                if (tangible) {
                    if (centerX>500) {
                        $(".rightPanel").addClass("panelVisible");
                    } else {
                        $(".rightPanel").removeClass("panelVisible");
                    }
                    centerX = (x[0]+x[1]+x[2]+x[3])/4;
                    centerY = (y[0]+y[1]+y[2]+y[3])/4;

                    document.getElementById("centerIndicator").style.top = centerY.toString() + "px";
                    document.getElementById("centerIndicator").style.left = centerX.toString() + "px";
                }
                
            }

            if (last_original_event != e.originalType) {
                last_original_event = e.originalType;
                $("#original-event").html(e.originalType + "<br/>" + $("#original-event").html());
                if (timeout_id !== null) window.clearTimeout(timeout_id);
                timeout_id = window.setTimeout(
	                function () {
	                    $("#original-event").html("");
	                },
	                5000);
            }
        };

        

        $("#test-area").on("touch_start", handler);
        $("#test-area").on("touch_move", handler);
        $("#test-area").on("touch_end", handler);
    </script>
</body>
</html>
